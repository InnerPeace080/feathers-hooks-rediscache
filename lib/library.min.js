!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("library",[],t):"object"==typeof exports?exports.library=t():e.library=t()}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t}return n(e,[{key:"clearSingle",value:function(e){var t=this;return new Promise(function(r,n){t.client.del(""+e,function(e,t){e&&n(!1),1===t&&r(!0),r(!1)})})}},{key:"clearGroup",value:function(e){var t=this;return new Promise(function(r,n){t.client.lrange(e,0,-1,function(a,o){a&&n(a),t.clearAll(o).then(t.client.del(e,function(e,t){r(1===t)}))})})}},{key:"clearAll",value:function(e){var t=this;return new Promise(function(r){e.length||r(!1);for(var n=0;n<e.length;n++)t.clearSingle(e[n]).then(function(t){n===e.length-1&&r(t)})})}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),a=c(r(4)),o=r(6),u=r(7);function c(e){return e&&e.__esModule?e:{default:e}}t.default={redisClient:a.default,cacheRoutes:n.default,hookCache:o.cache,hookRemoveCacheInformation:o.removeCacheInformation,redisBeforeHook:u.before,redisAfterHook:u.after,redisClearGroupHook:u.clearGroup},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(3)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}var u=200,c=204,s=500;t.default=function(e){var t=n.default.Router(),r=e.get("redisCacheClient"),o=new a.default(r);return t.get("/clear",function(e,t){}),t.get("/clear/single/:target",function(e,t){var n=e.params.target,a=e.query,i=a&&0!==Object.keys(a).length;n&&(i&&(n=e.url.split("/")[3]),r.get("cache:"+n,function(e,r){e?t.status(s).json({message:"something went wrong"+e.message}):r?o.clearSingle("cache:"+n).then(function(e){t.status(u).json({message:"cache cleared for key ("+(i?"with":"without")+" params): "+n,status:u})}):t.status(u).json({message:"cache already cleared for key ("+(i?"with":"without")+" params): "+n,status:c})}))}),t.get("/clear/group/:target",function(e,t){var n=e.params.target;n&&(n="group-"+n,r.lrange("cache:"+n,0,-1,function(r,a){r?t.status(s).json({message:"something went wrong"+r.message}):a&&Array.isArray(a)&&a.length>0?o.clearGroup("cache:"+n).then(function(r){t.status(u).json({message:"cache cleared for the group key: "+e.params.target,status:u})}):t.status(u).json({message:"cache already cleared for the group key: "+n,status:c})}))}),t},e.exports=t.default},function(e,t){e.exports=require("express")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return function(){var r,a=this;return e?r=e:(r=n.default.createClient(t||this.get("redis"))).on("error",function(e){a.error&&a.error(e&&e.stack||e)}),this.set("redisCacheClient",r),this}};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(5));e.exports=t.default},function(e,t){e.exports=require("redis")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cache=function(e){return e=Object.assign({},n,e),function(t){if(!t.result.hasOwnProperty("cache")){var r={};if(Array.isArray(t.result)){var n=t.result;r.wrapped=n,t.result={}}r=Object.assign({},r,{duration:e.duration||86400}),t.result.cache=r}return Promise.resolve(t)}},t.removeCacheInformation=function(e){return e=Object.assign({},n,e),function(e){return e.result.hasOwnProperty("cache")&&delete e.result.cache,Promise.resolve(e)}};var n={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.before=function(e){return e=Object.assign({},s,e),function(e){return new Promise(function(t){var r=e.app.get("redisCacheClient"),u=e.app.get("redisCache"),c=u.env||"production",s=(0,o.parsePath)(e,u);e.pathForRedisCache=s,r.get("cache:"+s,function(r,o){if(null===r)if(o){var u=JSON.parse(o);if(u.cache){var i=(0,n.default)(u.cache.expiresOn).format("DD MMMM YYYY - HH:mm:ss");e.result=u,t(e),"production"!==c&&(console.log(a.default.cyan("[redis]")+" returning cached value for "+a.default.green(s)+"."),console.log("> Expires on "+i+"."))}else t(e)}else t(e);else t(e)})})}},t.after=function(e){return e=Object.assign({},s,e),function(e){return new Promise(function(t){if(!e.result||!e.result.cache||!e.result.cache.cached){var r=e.app.get("redisCache"),u=r.env||"production",c=r.defaultDuration?r.defaultDuration:86400,s=e.result&&e.result.cache?e.result.cache.duration:c,i=e.app.get("redisCacheClient"),l=e.pathForRedisCache||(0,o.parsePath)(e,r);e.result=e.result||{},e.result.cache=Object.assign(e.result.cache||{},{cached:!0,duration:s,expiresOn:(0,n.default)().add(n.default.duration(s,"seconds")),parent:e.path,group:e.path?"group-"+e.path:"",key:l}),i.set("cache:"+l,JSON.stringify(e.result)),i.expire("cache:"+l,e.result.cache.duration),e.path&&i.rpush("cache:"+e.result.cache.group,"cache:"+l),"production"!==u&&(console.log(a.default.cyan("[redis]")+" added "+a.default.green(l)+" to the cache."),console.log("> Expires in "+n.default.duration(s,"seconds").humanize()+"."))}if(e.result&&e.result.cache&&e.result.cache.hasOwnProperty("wrapped")){var f=e.result.cache.wrapped;e.result=f}t(e)})}},t.clearGroup=function(e){return function(t){var r=e||t.path;if(r){var n=t.app.get("redisCacheClient"),a=new u.default(n),o=t.app.get("redisCache"),c=o.env||"production";r="group-"+r,n.lrange("cache:"+r,0,-1,function(e,t){e?console.error({message:"something went wrong"+e.message}):t&&Array.isArray(t)&&t.length>0?a.clearGroup("cache:"+r).then(function(e){"production"!==c&&console.log({message:"cache cleared for the group key: "+r})}):"production"!==c&&console.log({message:"cache already cleared for the group key: "+r})})}}};var n=c(r(8)),a=c(r(9)),o=r(10),u=c(r(0));function c(e){return e&&e.__esModule?e:{default:e}}var s={}},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("chalk")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePath=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{removePathFromCacheKey:!1,parseNestedRoutes:!1},r=e.params.query||{},n=t.removePathFromCacheKey,a=t.parseNestedRoutes,o=n&&e.id?"":""+e.path;return!n&&a&&(o=function(e,t){for(var r=new RegExp(":([^\\/\\?]+)\\??","g"),n=null;null!==(n=r.exec(e));)Object.keys(t.route).includes(n[1])&&(e=e.replace(n[0],t.route[n[1]]));return e}(o,e.params)),e.id?(0===o.length||n||(o+="/"),Object.keys(r).length>0?o+=e.id+"?"+JSON.stringify(r):o+=""+e.id):Object.keys(r).length>0&&(o+="?"+JSON.stringify(r)),o}}])});
//# sourceMappingURL=library.min.js.map